Guia de Build e Deploy no Docker Hub - Sistema Trocas
ğŸ“‹ PrÃ©-requisitos

Docker instalado e rodando
Conta no Docker Hub criada
Prisma Client gerado localmente

ğŸ”§ PreparaÃ§Ã£o do Ambiente

1. Gerar o Prisma Client Localmente (IMPORTANTE!)

# No diretÃ³rio raiz do projeto

cd apps/backend

# Instalar dependÃªncias se necessÃ¡rio

pnpm install

# Gerar o Prisma Client

pnpm prisma generate

# Verificar se foi gerado corretamente

ls -la src/generated/prisma/

# Deve mostrar os arquivos do Prisma Client

2. Login no Docker Hub
   docker login

# Digite seu username e senha do Docker Hub

ğŸš€ Build das Imagens
Backend

# A partir do diretÃ³rio raiz do projeto (onde estÃ¡ pnpm-workspace.yaml)

docker build --platform linux/amd64 -t felipebatista54/sistema-trocas-backend:latest --no-cache -f apps/backend/Dockerfile.production .

Frontend

# A partir do diretÃ³rio raiz do projeto

docker build --platform linux/amd64 \\
-t felipebatista54/sistema-trocas-frontend:latest \\
--no-cache \\
-f apps/frontend/Dockerfile .

ğŸ§ª Teste Local (Opcional mas Recomendado)
Testar Backend
docker run -p 3000:3000 \\
-e DATABASE_URL=\"postgresql://user:password@host:5432/database\" \\
-e JWT_SECRET=\"seu_jwt_secret_aqui\" \\
felipebatista54/sistema-trocas-backend:latest

Testar Frontend
docker run -p 3001:3000 \\
-e NEXT_PUBLIC_API_URL=\"http://localhost:3000\" \\
felipebatista54/sistema-trocas-frontend:latest

ğŸ“¤ Deploy no Docker Hub
Push das Imagens

# Backend

docker push felipebatista54/sistema-trocas-backend:latest

# Frontend

docker push felipebatista54/sistema-trocas-frontend:latest

ğŸ·ï¸ Versionamento (Recomendado)
Criar Tags EspecÃ­ficas

# Backend com versÃ£o

docker tag felipebatista54/sistema-trocas-backend:latest \\
felipebatista54/sistema-trocas-backend:v1.0.0

docker push felipebatista54/sistema-trocas-backend:v1.0.0

# Frontend com versÃ£o

docker tag felipebatista54/sistema-trocas-frontend:latest \\
felipebatista54/sistema-trocas-frontend:v1.0.0

docker push felipebatista54/sistema-trocas-frontend:v1.0.0

ğŸ“ Script Automatizado
Crie um arquivo build-and-deploy.sh:
#!/bin/bash

# Cores para output

GREEN='\\033[0;32m'
RED='\\033[0;31m'
NC='\\033[0m' # No Color

# FunÃ§Ã£o para verificar sucesso

check_success() {
if [ $? -eq 0 ]; then
echo -e \"${GREEN}âœ“ $1 concluÃ­do com sucesso${NC}\"
else
echo -e \"${RED}âœ— Erro em $1${NC}\"
exit 1
fi
}

# Verificar se estÃ¡ no diretÃ³rio correto

if [ ! -f \"pnpm-workspace.yaml\" ]; then
echo -e \"${RED}Erro: Execute este script no diretÃ³rio raiz do projeto${NC}\"
exit 1
fi

# 1. Gerar Prisma Client

echo \"ğŸ”§ Gerando Prisma Client...\"
cd apps/backend
pnpm prisma generate
check_success \"GeraÃ§Ã£o do Prisma Client\"
cd ../..

# 2. Build Backend

echo \"ğŸ—ï¸ Building Backend...\"
docker build --platform linux/amd64 \\
-t felipebatista54/sistema-trocas-backend:latest \\
--no-cache \\
-f apps/backend/Dockerfile .
check_success \"Build do Backend\"

# 3. Build Frontend

echo \"ğŸ—ï¸ Building Frontend...\"
docker build --platform linux/amd64 \\
-t felipebatista54/sistema-trocas-frontend:latest \\
--no-cache \\
-f apps/frontend/Dockerfile .
check_success \"Build do Frontend\"

# 4. Push para Docker Hub

echo \"ğŸ“¤ Fazendo push para Docker Hub...\"
docker push felipebatista54/sistema-trocas-backend:latest
check_success \"Push do Backend\"

docker push felipebatista54/sistema-trocas-frontend:latest
check_success \"Push do Frontend\"

echo -e \"${GREEN}ğŸ‰ Deploy concluÃ­do com sucesso!${NC}\"

Tornar o script executÃ¡vel:
chmod +x build-and-deploy.sh

Executar:
./build-and-deploy.sh

âš ï¸ Pontos Importantes

Sempre gere o Prisma Client antes do build - O Dockerfile estÃ¡ configurado para copiar o Prisma jÃ¡ gerado
Use --platform linux/amd64 para garantir compatibilidade
Verifique as variÃ¡veis de ambiente necessÃ¡rias antes do deploy
Teste localmente antes de fazer push
Use tags de versÃ£o alÃ©m de latest para melhor controle

ğŸ” Comandos Ãšteis

# Ver imagens locais

docker images | grep sistema-trocas

# Remover imagens antigas

docker rmi felipebatista54/sistema-trocas-backend:old-tag

# Ver logs de container rodando

docker logs -f <container-id>

# Inspecionar imagem

docker inspect felipebatista54/sistema-trocas-backend:latest

ğŸ“Š Verificar no Docker Hub
ApÃ³s o push, verifique suas imagens em:

https://hub.docker.com/r/felipebatista54/sistema-trocas-backend
https://hub.docker.com/r/felipebatista54/sistema-trocas-frontend

Este guia deve facilitar futuros builds e deploys, evitando os problemas com o Prisma que vocÃª enfrentou!

# Backend com versÃ£o

docker tag felipebatista54/sistema-trocas-backend:latest \
 felipebatista54/sistema-trocas-backend:v1.0.6

docker push felipebatista54/sistema-trocas-backend:v1.0.6

# Frontend com versÃ£o

docker tag felipebatista54/sistema-trocas-frontend:latest \
 felipebatista54/sistema-trocas-frontend:v1.0.2

docker push felipebatista54/sistema-trocas-frontend:v1.0.2
